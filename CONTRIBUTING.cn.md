# è´¡çŒ®æŒ‡å—

é¦–å…ˆï¼Œæ„Ÿè°¢ä½ è€ƒè™‘ä¸º Sandbox Executor åšå‡ºè´¡çŒ®ï¼æ­£æ˜¯åƒä½ è¿™æ ·çš„äººè®©å®ƒæˆä¸ºäº†ä¸€ä¸ªå¦‚æ­¤å‡ºè‰²çš„å·¥å…·ã€‚

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

Sandbox Executor æ—¨åœ¨ä¸ºåŸºäº WebAssembly çš„æ²™ç›’æä¾›é«˜çº§çš„ã€ä»¥å‡½æ•°ä¸ºä¸­å¿ƒçš„ APIã€‚

### è®¾è®¡ç†å¿µ

* **æ ‡å‡† I/O ä½œä¸ºé€šä¿¡æ¡¥æ¢**: ä½¿ç”¨ `stdin` ä½œä¸ºæ²™ç›’å†…çš„å‡½æ•°è¾“å…¥ï¼Œ`stdout` ä½œä¸ºå‡½æ•°è¾“å‡ºã€‚è¿™ç§è®¾è®¡ä½¿å¾—æ‰§è¡Œå™¨èƒ½å¤Ÿæ”¯æŒä»»æ„ç¼–ç¨‹è¯­è¨€ï¼Œå¹¶èƒ½æ›´æ–¹ä¾¿åœ°å¯¹å®é™…æ²™ç›’åº“è¿›è¡Œæ›´æ¢æˆ–è¿­ä»£ã€‚
* **SIP (Sandbox Input Protocol)**: ä¸ºäº†ç¡®ä¿é²æ£’æ€§å’Œæœªæ¥æ‰©å±•æ€§ï¼Œè¾“å…¥é‡‡ç”¨é•¿åº¦å‰ç¼€åè®®ï¼š
  * **ç¬¬ 1 å­—èŠ‚**: æ¨¡å¼ï¼ˆ`'A'` ä»£è¡¨åŸå­æ¨¡å¼ï¼Œ`'S'` ä»£è¡¨æµæ¨¡å¼ï¼Œ`'P'` ä»£è¡¨æŒä¹…æ¨¡å¼ï¼‰ã€‚
  * **ç¬¬ 2-9 å­—èŠ‚**: 8 å­—ç¬¦çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œè¡¨ç¤º JSON è´Ÿè½½çš„å­—èŠ‚é•¿åº¦ã€‚
  * **åç»­å­—èŠ‚**: JSON æ ¼å¼çš„è°ƒç”¨è¯·æ±‚ï¼ˆåŒ…å« `functionName`, `args`, `kwargs` ç­‰ï¼‰ã€‚
  * **æ³¨æ„**: ä½¿ç”¨åå…­è¿›åˆ¶ç¼–ç é•¿åº¦æ˜¯å› ä¸ºåº•å±‚ `runFS` çš„ `stdin` ä»…æ”¯æŒå­—ç¬¦ä¸²ã€‚äºŒè¿›åˆ¶é•¿åº¦å­—èŠ‚åœ¨ UTF-8 ç¼–ç è¿‡ç¨‹ä¸­å¯èƒ½ä¼šè¢«æŸåæˆ–å¯¼è‡´é•¿åº¦å˜åŒ–ã€‚åå…­è¿›åˆ¶ç¡®ä¿äº† ASCII å®‰å…¨ã€‚
* **Proxy/User-Code Separation**: æ¯ç§è¯­è¨€éƒ½ç”±ä¸€ä¸ª `main` ä»£ç†ç¨‹åºè´Ÿè´£å¤„ç† SIP åè®®ï¼Œå¹¶åŠ¨æ€åŠ è½½å­˜æ”¾ç”¨æˆ·é€»è¾‘çš„ `user_code` æ–‡ä»¶ã€‚

### ğŸ—ï¸ å‚æ•°ä¼ é€’æœºåˆ¶

ä¸ºäº†å¹³è¡¡æ€§èƒ½ã€å¯é æ€§å’Œæ•°æ®é‡ï¼ŒSandbox Executor æ”¯æŒä¸‰ç§ä¸åŒçš„å‚æ•°ä¼ é€’æ¨¡å¼ã€‚`auto` æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ä¼šæ™ºèƒ½åœ°é€‰æ‹©æœ€ä½³ç­–ç•¥ã€‚

#### 1. `inline` æ¨¡å¼ (æœ€å¿«)

* **æœºåˆ¶**: å°†å‚æ•°åºåˆ—åŒ–ä¸ºç›®æ ‡è¯­è¨€çš„å­—é¢é‡ï¼Œç›´æ¥ç¡¬ç¼–ç åˆ°ç”Ÿæˆçš„ `main` ä»£ç†æºä»£ç ä¸­ã€‚
* **ä¼˜ç‚¹**: è¿è¡Œæ—¶é€šä¿¡å¼€é”€ä¸ºé›¶ï¼›ç»•è¿‡æ‰€æœ‰ `stdin` é™åˆ¶ã€‚
* **ç¼ºç‚¹**: æºä»£ç ä½“ç§¯å¢åŠ ï¼›å¦‚æœè½¬ä¹‰ä¸å½“å­˜åœ¨ä»£ç æ³¨å…¥é£é™©ã€‚
* **é€‚ç”¨åœºæ™¯**: å°æ•°æ®é‡ã€ç®€å•çš„å‡½æ•°è°ƒç”¨ï¼ˆä¾‹å¦‚å°äº 4KBï¼‰ã€‚

#### 2. `stdin` æ¨¡å¼ (æ ‡å‡†)

* **æœºåˆ¶**: é€šè¿‡æ ‡å‡†è¾“å…¥æµä½¿ç”¨ **SIP (Sandbox Input Protocol)**ï¼ˆé•¿åº¦å‰ç¼€çš„ JSONï¼‰ä¼ é€’å‚æ•°ã€‚
* **ä¼˜ç‚¹**: æ•°æ®ä¸æºä»£ç è§£è€¦ï¼›ç¬¦åˆæ ‡å‡† WASI é€šä¿¡ã€‚
* **ç¼ºç‚¹**: å—åº•å±‚æ²™ç›’**éæµå¼** `stdin` å®ç°çš„é™åˆ¶ï¼ˆå½“å‰ `runFS` ä¸­ä¸º **8KB** ç¼“å†²ï¼‰ã€‚å‘é€å¤§æ•°æ®é‡ä¼šå¯¼è‡´è¶…æ—¶æˆ–æˆªæ–­ã€‚
* **é€‚ç”¨åœºæ™¯**: ä¸­ç­‰æ•°æ®é‡ï¼ˆ4KB åˆ° 8KBï¼‰ã€‚

#### 3. `file` æ¨¡å¼ (æœ€å¥å£®)

* **æœºåˆ¶**: å°†å‚æ•°å†™å…¥æ²™ç›’ VFS å†…çš„ä¸´æ—¶è™šæ‹Ÿ JSON æ–‡ä»¶ï¼ˆä¾‹å¦‚ `/workspace/.sandbox_request.json`ï¼‰ã€‚ä»£ç†ç¨‹åºåœ¨å¯åŠ¨æ—¶è¯»å–æ­¤æ–‡ä»¶ã€‚
* **ä¼˜ç‚¹**: ç»•è¿‡æ‰€æœ‰ `stdin` ç¼“å†²åŒºé™åˆ¶ï¼›å¯¹äºæå¤§è·¨åº¦çš„æ•°æ®ï¼ˆå¦‚ Base64 å­—ç¬¦ä¸²ï¼‰æå…¶å¯é ã€‚
* **é€‚ç”¨åœºæ™¯**: å¤§æ•°æ®é‡ (> 8KB) æˆ– `stdin` ä¸ç¨³å®šçš„ç¯å¢ƒã€‚

### ğŸ§  `auto` é€‰æ‹©é€»è¾‘

`SandboxExecutor` ä¼šè¯„ä¼°å‚æ•°çš„æ€»å¤§å°å¹¶é€‰æ‹©ï¼š

* **å¤§å° < 4KB**: å¦‚æœè¯­è¨€æ”¯æŒï¼Œä½¿ç”¨ `inline`ã€‚
* **4KB <= å¤§å° < 8KB**: ä½¿ç”¨ `stdin`ã€‚
* **å¤§å° >= 8KB**: ä½¿ç”¨ `file`ã€‚

---

### âš ï¸ è¸©å‘æ€»ç»“ä¸ç»éªŒ

åœ¨å‚æ•°ä¼ é€’æœºåˆ¶å·¥ä¸šåŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è§£å†³äº†å‡ ä¸ªå…³é”®é—®é¢˜ï¼š

#### 1. 8KB Stdin ä¹‹å¢™

`runno` çš„ `runFS` å®ç°å¯¹ `stdin` æœ‰å›ºå®šç¼“å†²åŒºã€‚å‘é€è¶…è¿‡ 8188 å­—èŠ‚ä¼šå¯¼è‡´ç«‹å³æŒ‚èµ·æˆ–é™é»˜å¤±è´¥ã€‚

* **ä¿®å¤**: å¼•å…¥ `file` æ¨¡å¼ï¼ˆåŸºäº VFSï¼‰å½»åº•è§£å†³äº†æ‰€æœ‰è¯­è¨€çš„å¤§æ•°æ®ä¼ é€’é—®é¢˜ã€‚

#### 2. Python "ä¸€ä¸ªå‚æ•°æ”¶åˆ°äº†å¤šä¸ªå€¼" é”™è¯¯

å½“æ··åˆä½¿ç”¨ä½ç½®å‚æ•° `args` å’Œå…³é”®å­—å‚æ•° `kwargs` æ—¶ï¼ˆä¾‹å¦‚ `func(*[None, 2], **{'a': 1})`ï¼‰ï¼Œå¦‚æœ `a` æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒPython ä¼šæŠ›å‡º `TypeError`ã€‚

* **ä¿®å¤**: åœ¨ `normalizeArguments` ä¸­å®ç°äº† **å¡«è¡¥å­”æ´ (Hole-filling) é€»è¾‘**ã€‚å¦‚æœ `args` æ•°ç»„å­˜åœ¨ç©ºç¼ºï¼Œæ‰§è¡Œå™¨ä¼šæ ¹æ®å‡½æ•°ç­¾åï¼Œåœ¨å°†å‚æ•°ä¼ é€’ç»™æ²™ç®±å‰ï¼Œä» `kwargs` ä¸­æå–åŒ¹é…çš„é”®å¡«å…¥è¿™äº›ç©ºç¼ºã€‚

#### 3. C++ ä¸¥æ ¼æ€§

* **å†…å­˜åˆ†é…**: åœ¨ C++ ä¸­ï¼Œ`malloc` è¿”å› `void*`ï¼Œå¿…é¡»è¿›è¡Œæ˜¾å¼ç±»å‹è½¬æ¢ï¼ˆä¾‹å¦‚ `(char*)malloc(...)`ï¼‰ã€‚å…±äº«çš„ C æ¨¡æ¿å¿…é¡»åŒ…å«è¿™äº›è½¬æ¢æ‰èƒ½ä½œä¸ºåˆæ³•çš„ C++ ç¼–è¯‘ã€‚
* **ç±»å‹é‡è½½**: è¿”å› `std::string` çš„ C++ å‡½æ•°ä¸èƒ½ç›´æ¥ä¼ é€’ç»™ `cJSON_CreateString(const char*)`ã€‚
* **ä¿®å¤**: åœ¨åˆ†å‘å™¨ï¼ˆDispatcherï¼‰ä¸­æ³¨å…¥äº† C++ è¾…åŠ©å‡½æ•°/é‡è½½ï¼Œä»¥é€æ˜åœ°å¤„ç† `std::string`ã€‚

#### 4. ç»å¯¹è·¯å¾„ä¸€è‡´æ€§

æ²™ç®±ä¸­çš„ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ `./file.json`ï¼‰å¯èƒ½ä¼šå› å…¥å£ç‚¹ä¸åŒè€Œäº§ç”Ÿæ­§ä¹‰ã€‚

* **ä¿®å¤**: å§‹ç»ˆä½¿ç”¨ç»å¯¹è·¯å¾„ï¼ˆå¦‚ `/workspace/.sandbox_request.json`ï¼‰ï¼Œå¹¶é€šè¿‡ç¯å¢ƒå˜é‡æˆ– `#define` å®ä¼ é€’ç»™ä»£ç†ç¨‹åºã€‚

#### 5. C æ¨¡æ¿ä¸­çš„å­—ç¬¦ä¸²è½¬ä¹‰

ä» JavaScript å­—ç¬¦ä¸²ç”Ÿæˆ C ä»£ç æ—¶ï¼Œ`\n` and `\0` å¯èƒ½ä¼šè¢«äºŒæ¬¡å¤„ç†ã€‚

* **ä¿®å¤**: åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²æˆ–ä»”ç»†æ§åˆ¶è½¬ä¹‰ã€‚ç¡®ä¿ `cJSON` æ‰“å°æœºä½¿ç”¨è¶³å¤Ÿå¤§çš„åŠ¨æ€ç¼“å†²åŒºï¼ˆ8KB+ï¼‰ï¼Œä»¥é˜²æ­¢åºåˆ—åŒ–å¤æ‚ç»“æœæ—¶å‘ç”Ÿå†…å­˜æŸåã€‚

#### 6. API å±‚çº§ä¸æ˜“ç”¨æ€§ (V0.2 æ–°å¿ƒå¾—)

æ­¤å‰ï¼Œ`FunctionCallRequest` æ··åˆäº†ä¸åŒå±‚çº§çš„å…³æ³¨ç‚¹ã€‚
* **ç²¾åŒ–å±‚çº§**ï¼šæˆ‘ä»¬å°†å¸¸ç”¨çš„æ‰§è¡Œå‚æ•°ï¼ˆå¦‚ `timeout` å’Œ `argsMode`ï¼‰æå‡åˆ°æ ¹è¯·æ±‚ä¸­ï¼Œä»¥æå‡å¼€å‘ä½“éªŒã€‚è€Œå°†ç¯å¢ƒç›¸å…³çš„é…ç½®ï¼ˆå¦‚ `mount`ã€`files` å’Œ `workdir`ï¼‰ç»Ÿä¸€å½’ç±»åˆ° `options` å¯¹è±¡ä¸­ã€‚
* **Reporting é‡å‘½å**ï¼šå°† `resultOptions` é‡å‘½åä¸º `reporting`ï¼Œæ›´å‡†ç¡®åœ°è¡¨è¾¾äº†å…¶â€œæ§åˆ¶æ²™ç›’åé¦ˆå“ªäº›å…ƒæ•°æ®â€çš„åˆè¡·ã€‚

#### 7. Schema å½’ä¸€åŒ–ä¸ C åˆ†å‘å™¨æ’åº (V0.2 æ–°å¿ƒå¾—)

* **InputSchema**ï¼šæˆ‘ä»¬ä»ç®€å•çš„ `ParamSchema[]` æ•°ç»„è½¬å‘äº†æ›´å¼ºå¤§çš„ `InputSchema`ï¼ˆRecord æˆ– JsonSchema æ•°ç»„ï¼‰ï¼Œä»¥æ›´å¥½åœ°é€‚é… AI å·¥å…·è°ƒç”¨ã€‚
* **C ç”Ÿæˆå™¨åˆ†å‘é€»è¾‘**ï¼šç”±äº `input` ç°åœ¨å¯ä»¥æ˜¯é”®å€¼å¯¹å¯¹è±¡ï¼ŒC ç”Ÿæˆå™¨å¿…é¡»åœ¨ç”Ÿæˆ `dispatcher` æ—¶æ ¹æ®å‚æ•°çš„ `index` å±æ€§è¿›è¡Œæ’åºï¼Œä»¥ç¡®ä¿åœ¨ä¸æ”¯æŒåå°„çš„è¯­è¨€ä¸­èƒ½æŒ‰æ­£ç¡®çš„ç‰©ç†é¡ºåºè¿›è¡Œä½ç½®å‚æ•°è°ƒç”¨ã€‚

### æ ¸å¿ƒç»„ä»¶

1. **`SandboxExecutor` (src/executor.ts)**: ä¸»è¦å…¥å£ç‚¹ã€‚å®ƒç¼–æ’æ•´ä¸ªæ‰§è¡Œç”Ÿå‘½å‘¨æœŸï¼š
    * ç­¾åæ¨æ–­ã€‚
    * æ–‡ä»¶ç³»ç»Ÿå‡†å¤‡ï¼ˆåŒ…å«ç”Ÿæˆä»£ç†æ–‡ä»¶å’Œç”¨æˆ·ä»£ç æ–‡ä»¶ï¼‰ã€‚
    * é€šè¿‡ `generateStdin` æ„å»º SIP æ•°æ®åŒ…ã€‚
    * é€šè¿‡ `@runno/sandbox` è¿›è¡Œ WASM æ‰§è¡Œã€‚
    * æ‰§è¡Œåçš„å˜æ›´æ£€æµ‹å’Œç»“æœè§£æã€‚

2. **ä»£ç ç”Ÿæˆå™¨ (src/generators/)**:
    * æ¯ç§è¯­è¨€éƒ½æœ‰ä¸€ä¸ª `CodeGenerator`ï¼Œå®ç° `generateFiles` å’Œ `generateStdin`ã€‚
    * ä»£ç†ç¨‹åºè´Ÿè´£ä» `stdin` è¯»å– SIP åŒ…ï¼Œè§£æå¹¶è°ƒç”¨ç›®æ ‡å‡½æ•°ï¼Œå°†ç»“æœåºåˆ—åŒ–åˆ° `stdout`ã€‚
    * **é™æ€ä»£ç†ä¸åŠ¨æ€è½¬å‘**: å¯¹äºä¸æ”¯æŒåå°„çš„è¯­è¨€ï¼ˆå¦‚ C/C++ï¼‰ï¼Œç”Ÿæˆå™¨ä¼šæ ¹æ® `signature.input` åŠ¨æ€ç”Ÿæˆä¸€ä¸ª `dispatcher` èƒ¶æ°´å±‚æ¥å¤„ç†å‡½æ•°åˆ†å‘ã€‚

3. **ç­¾åæ¨æ–­ (src/inference/engine.ts)**:
    * ä½¿ç”¨é™æ€åˆ†æï¼ˆåŸºäºæ­£åˆ™ï¼‰å’Œè¯­è¨€çº¦å®šæ¥ç¡®å®šå‡½æ•°å‚æ•°ã€‚
    * è§£æç­¾åå¹¶è¾“å‡ºåŒ…å« `input: InputSchema` çš„ `InferredSignature`ã€‚

4. **æ–‡ä»¶ç³»ç»Ÿç®¡ç† (src/fs/)**:
    * **`FSBuilder`**: æ„å»ºåˆå§‹çš„ `WASIFS` å¯¹è±¡ã€‚
    * **`FileSystemDiffer`**: é€šè¿‡åœ¨æ‰§è¡Œå‰æ‹æ‘„å¿«ç…§ï¼ˆSnapshotï¼‰å¹¶ä¸ WASM è¿è¡Œæ—¶çš„ç»“æœè¿›è¡Œå¯¹æ¯”æ¥å¤„ç†å˜æ›´æ£€æµ‹ã€‚è¿™ç§åŸºäºå¿«ç…§çš„æ–¹æ³•ç¡®ä¿äº†ä¸ WASM Worker çš„å…¼å®¹æ€§ï¼ˆProxy å¯¹è±¡æ— æ³•è¢«ç»“æ„åŒ–å…‹éš†ç®—æ³•å…‹éš†ï¼‰ã€‚
    * **`SyncManager`**: å°†è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿçš„å˜æ›´åŒæ­¥å›çœŸå®ç£ç›˜ï¼Œå¹¶æ‰§è¡Œé…ç½®çš„æƒé™ã€‚
    * **`PermissionResolver`**: è®¡ç®—åŸºäº glob çš„è§„åˆ™ä»¥å…è®¸æˆ–æ‹’ç»æ–‡ä»¶æ“ä½œã€‚

## ğŸš€ å¼€å‘æµç¨‹

### å‰ææ¡ä»¶

* Node.js >= 20.11.1
* pnpm

### è®¾ç½®

```bash
git clone https://github.com/isdk/sandbox-executor.js.git
cd sandbox-executor.js
pnpm install
```

### æ„å»º

```bash
pnpm run build
```

### æµ‹è¯•

æˆ‘ä»¬ä½¿ç”¨ [Vitest](https://vitest.dev/) è¿›è¡Œæµ‹è¯•ã€‚

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm test

# è¿è¡Œæµ‹è¯•å¹¶æŸ¥çœ‹è¦†ç›–ç‡
pnpm test:coverage

# ä»…è¿è¡Œé›†æˆæµ‹è¯•ï¼ˆéœ€è¦ç½‘ç»œ/runno ç¯å¢ƒï¼‰
npx vitest test/integration
```

## ğŸŒ æ·»åŠ æ–°è¯­è¨€æ”¯æŒ

è¦æ·»åŠ æ–°è¯­è¨€ï¼Œä½ éœ€è¦æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

1. **æ·»åŠ è¯­è¨€ç±»å‹**: æ›´æ–° `src/types/request.ts` ä¸­çš„ `SupportedLanguage`ã€‚
2. **å®ç°ç”Ÿæˆå™¨**: åˆ›å»º `src/generators/<language>.ts` å¹¶ç»§æ‰¿ `CodeGenerator`ã€‚
    * å®ç° `generateWrapper`: åˆ›å»ºè°ƒç”¨ç”¨æˆ·å‡½æ•°å¹¶åœ¨æ ‡è®°ä¹‹é—´æ‰“å° JSON è¾“å‡ºçš„ä»£ç ã€‚
    * å®ç° `serialize`: å¦‚ä½•å°† JS ç±»å‹è½¬æ¢ä¸ºç›®æ ‡è¯­è¨€çš„å­—é¢é‡ã€‚
3. **æ³¨å†Œç”Ÿæˆå™¨**: å°†ä½ çš„ç”Ÿæˆå™¨æ·»åŠ åˆ° `src/generators/index.ts` ä¸­çš„æ˜ å°„ä¸­ã€‚
    * **è¿è¡Œæ—¶æ˜ å°„**: å¦‚æœ Runno çš„è¿è¡Œæ—¶åç§°ä¸ä½ çš„è¯­è¨€åç§°ä¸åŒï¼ˆä¾‹å¦‚ `php` -> `php-cgi`ï¼‰ï¼Œè¯·æ›´æ–° `getRuntime`ã€‚
    * **C/C++ æ³¨æ„äº‹é¡¹**: å½“å‰æ²™ç›’ç¯å¢ƒä¸­çš„ `clang` å’Œ `clangpp` å­˜åœ¨ä¸€äº›é™åˆ¶ï¼š
        * **å¼‚å¸¸**: å¼‚å¸¸å·²è¢«ç¦ç”¨ã€‚ä¸è¦åœ¨åŒ…è£…ä»£ç ä¸­ä½¿ç”¨ `try-catch` å—ã€‚
        * **æ ‡å‡†**: ä½¿ç”¨å…¼å®¹ C++11 çš„ä»£ç ã€‚é¿å…ä½¿ç”¨ C++14/17/20 çš„ç‰¹æ€§ï¼Œå¦‚ `if constexpr` æˆ–ç±»å‹ç‰¹å¾å˜é‡ï¼ˆå¦‚ `is_same_v`ï¼‰ã€‚å¦‚æœéœ€è¦ï¼Œè¯·ä½¿ç”¨ä¼ ç»Ÿçš„æ¨¡æ¿ç‰¹åŒ–å’Œ `std::enable_if`ã€‚
4. **æ·»åŠ æ¨æ–­é€»è¾‘**: æ›´æ–° `src/inference/engine.ts`ã€‚
    * å®ç° `infer<Language>` æ–¹æ³•ï¼Œå°†å‡½æ•°ç­¾åè§£æä¸º `InputSchema`ã€‚
    * ä½¿ç”¨æ–°è¯­è¨€çš„é»˜è®¤è¡Œä¸ºæ›´æ–° `getConvention`ã€‚
5. **æ·»åŠ æµ‹è¯•**:
    * åœ¨ `test/unit/generators/` ä¸­æ·»åŠ ç”Ÿæˆå™¨çš„å•å…ƒæµ‹è¯•ã€‚
    * åœ¨ `test/unit/inference-engine.test.ts` ä¸­æ·»åŠ æ¨æ–­æµ‹è¯•ã€‚
    * åœ¨ `test/integration/executor.test.ts` å’Œ `test/integration/real-environment.test.ts` ä¸­æ·»åŠ é›†æˆæµ‹è¯•ã€‚

## ğŸ“ æ–‡ä»¶ç³»ç»Ÿè¿½è¸ªè¯¦æƒ…

ä¹‹å‰ï¼Œæˆ‘ä»¬å°è¯•è¿‡åŸºäº `Proxy` çš„æ–¹æ³• (`TrackedFileSystem`)ã€‚ä½†æ˜¯ï¼Œç”±äº `@runno/sandbox` åœ¨ Worker ä¸­æ‰§è¡Œ WASMï¼Œæ–‡ä»¶ç³»ç»Ÿå¯¹è±¡å¿…é¡»é€šè¿‡**ç»“æ„åŒ–å…‹éš†ç®—æ³• (Structured Clone Algorithm)** è¿›è¡Œå…‹éš†ã€‚ç”±äº **`Proxy` å¯¹è±¡æ— æ³•è¢«å…‹éš†**ï¼Œæˆ‘ä»¬åˆ‡æ¢åˆ°äº† `FileSystemDiffer`ã€‚

`FileSystemDiffer` çš„å·¥ä½œåŸç†ï¼š
1. åœ¨æ‰§è¡Œå‰å¯¹ `WASIFS` è¿›è¡Œ**æ·±åº¦æ‹·è´ï¼ˆSnapshotï¼‰**ã€‚
2. å°†çº¯ `WASIFS` å¯¹è±¡ä¼ é€’ç»™æ²™ç›’æ‰§è¡Œã€‚
3. å°†æ²™ç›’è¿”å›çš„ `WASIFS` ä¸åˆå§‹å¿«ç…§è¿›è¡Œå¯¹æ¯”ã€‚

è¿™ç§æ–¹æ³•å¯¹äºè·¨çº¿ç¨‹é€šä¿¡æ›´åŠ å¥å£®ï¼Œå¹¶èƒ½ç¡®ä¿æ•è·æ‰€æœ‰å˜æ›´ï¼ˆåŒ…æ‹¬ WASI è¿è¡Œæ—¶æœ¬èº«æ‰€åšçš„å˜æ›´ï¼‰ã€‚